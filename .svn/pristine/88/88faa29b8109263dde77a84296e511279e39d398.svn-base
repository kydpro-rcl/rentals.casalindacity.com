<?php
if ($_GET['id']!=''){
	header("Content-type: text/xml");
	require_once('../../booking/init.php');
	
	 $link= new getQueries();
	 $villa=$link->show_id($table='villas', $id=$_GET['id']);
	 $v=$villa[0];

	$protocol = ($_SERVER['HTTPS'] && $_SERVER['HTTPS'] != "off") ? "https" : "http";
	$base_url="$protocol://" . $_SERVER['SERVER_NAME'] . dirname($_SERVER["REQUEST_URI"]);
	 
	echo '<?xml version="1.0" encoding="UTF-8"?>';
	//echo '<!--Sample XML file generated by XMLSpy v2017 sp2 (x64) (http://www.altova.com)-->';
	//echo '<lodgingRateTestRequest xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="file:'.$base_url.'/xml/HA-XML-Listings-4.1.xsd">';
	echo '<lodgingRateContent xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="file:'.$base_url.'/xml/HA-XML-Listings-4.1.xsd">';
		echo '<documentVersion>4.1</documentVersion>';
		echo '<systemExternalId>'.$v['id'].'</systemExternalId>';
		echo '<advertiserExternalId>'.$v['id'].'</advertiserExternalId>';
		echo '<authorizationToken>String</authorizationToken>';
		echo '<lodgingRate>';
			echo '<currency>USD</currency>';
			echo '<externalUpdateDate>'.gmdate("Y-m-d\TH:i:s\Z").'</externalUpdateDate>';
			echo '<fees>';
				echo '<flatRefundableDamageDepositFees>';
					echo '<fee>';
						echo '<externalId>-</externalId>';
						echo '<amount>'.(75*$v['bed']).'</amount>';
						echo '<appliesPerStay>';
						echo '</appliesPerStay>';
					echo '</fee>';
				echo '</flatRefundableDamageDepositFees>';
			echo '</fees>';
			echo '<language>en</language>';
			echo '<nightlyRates>';
				echo '<fri>'.$v['p_shoulder'].'</fri>';
				echo '<mon>'.$v['p_shoulder'].'</mon>';
				echo '<nightlyOverrides>';
					echo '<override>';
						echo '<amount>'.$v['p_low'].'</amount>';
						echo '<nights>';
							echo '<range>';
								echo '<max>'.date('Y').'-09-31</max>';
								echo '<min>'.date('Y').'-05-01</min>';
							echo '</range>';
						echo '</nights>';
					echo '</override>';
					echo '<override>';
						echo '<amount>'.$v['p_high'].'</amount>';
						echo '<nights>';
							echo '<range>';
								echo '<max>'.date('Y').'-12-31</max>';
								echo '<min>'.date('Y').'-12-01</min>';
							echo '</range>';
						echo '</nights>';
					echo '</override>';
					echo '<override>';
						echo '<amount>'.$v['p_high'].'</amount>';
						echo '<nights>';
							echo '<range>';
								echo '<max>'.date('Y').'-02-28</max>';
								echo '<min>'.date('Y').'-01-01</min>';
							echo '</range>';
						echo '</nights>';
					echo '</override>';
				echo '</nightlyOverrides>';
				echo '<sat>'.$v['p_shoulder'].'</sat>';
				echo '<sun>'.$v['p_shoulder'].'</sun>';
				echo '<thu>'.$v['p_shoulder'].'</thu>';
				echo '<tue>'.$v['p_shoulder'].'</tue>';
				echo '<wed>'.$v['p_shoulder'].'</wed>';
			echo '</nightlyRates>';
			echo '<paymentSchedule>';
				echo '<payments>';
					echo '<payment>';
						echo '<dueType>AT_BOOKING</dueType>';
						echo '<requiresPercentOfTotalBooking>';
							echo '<percent>50</percent>';
						echo '</requiresPercentOfTotalBooking>';
					echo '</payment>';
					echo '<payment>';
						echo '<days>30</days>';
						echo '<dueType>BEFORE_CHECKIN</dueType>';
						echo '<requiresRemainder/>';
					echo '</payment>';
				echo '</payments>';
			echo '</paymentSchedule>';
			echo '<taxRules>';
				echo '<percentOfRentTaxRules>';
					echo '<rule>';
						echo '<activeLocalDateRange>';
							echo '<max>2025-12-31</max>';
							echo '<min>2017-12-31</min>';
						echo '</activeLocalDateRange>';
						echo '<currency>USD</currency>';
						echo '<name>Tax</name>';
						echo '<percent>18</percent>';
						echo '<appliesPerNight/>';
					echo '</rule>';
				echo '</percentOfRentTaxRules>';
			echo '</taxRules>';
		echo '</lodgingRate>';
		echo '<testDetails>';
			echo '<desiredCurrency>USD</desiredCurrency>';
			echo '<adults>'.$v['capacity'].'</adults>';
			echo '<children>'.$v['capacity'].'</children>';
			echo '<pets>0</pets>';
			echo '<arrivalDate>'.date('Y').'-02-13</arrivalDate>';
			echo '<departureDate>'.date('Y').'-02-15</departureDate>';
			echo '<travelerSite>HOMEAWAY_US</travelerSite>';
		echo '</testDetails>';
	echo '</lodgingRateContent>';
}